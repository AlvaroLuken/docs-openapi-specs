openapi: 3.1.0
info:
  title: ü™Ñ Paymaster Admin API
  version: '1.0'
servers:
  - url: https://manage.alchemy.com/
paths:
  '/api/paymaster/policy':
    post:
      summary: Create Policy
      description: Creates a new paymaster policy with the specified rules. Returns the policy id of a successfully created policy. The newly created policy will be in the ‚Äúinactive‚Äù status.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                app_id:
                  type: string
                  description: String ID of the app
                  default: '6d834x9k1yh4dx6z'
                rules:
                  $ref: './schemas.yaml#/components/schemas/Rules'
      responses:
        '200':
          description: Policy created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      policy:
                        $ref: './schemas.yaml#/components/schemas/Policy'
                  error:
                    type: object
                    properties:
                      msg:
                        type: string

  '/api/paymaster/policy/{id}':
    get:
      summary: Get Policy
      description: Returns a policy by id.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            default: 'a844e221-3c13-40c6-95db-d2db390e14b5'
      responses:
        '200':
          description: Policy fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      policy:
                        $ref: './schemas.yaml#/components/schemas/Policy'
                  error:
                    type: object
                    properties:
                      msg:
                        type: string

    delete:
      summary: Delete Policy
      description: Deletes a policy by id.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            default: '6d834x9k1yh4dx6z'
      responses:
        '200':
          description: Policy deleted successfully

    put:
      summary: Replace Policy
      description: Replaces all rules in an existing policy by id.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            default: 'a844e221-3c13-40c6-95db-d2db390e14b5'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                rules:
                  $ref: './schemas.yaml#/components/schemas/Rules'
      responses:
        '200':
          description: Policy rules replaced successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      policy:
                        $ref: './schemas.yaml#/components/schemas/Policy'
                  error:
                    type: object
                    properties:
                      msg:
                        type: string

  '/api/paymaster/policies':
    get:
      summary: Get All Policies
      description: Returns all policies under an app.
      parameters:
        - name: app
          in: query
          schema:
            type: string
            default: '6d834x9k1yh4dx6z'
        - name: after
          in: query
          schema:
            type: string
            format: base64url
            default: 'a844e221-3c13-40c6-95db-d2db390e14b5'
      responses:
        '200':
          description: Policies fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      policies:
                        type: array
                        items:
                          $ref: './schemas.yaml#/components/schemas/Policy'
                  error:
                    type: object
                    properties:
                      msg:
                        type: string

  '/api/paymaster/policy/{id}/status':
    put:
      summary: Update Policy Status
      description: Modifies the status of a policy to either "active" or "inactive".
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            default: 'a844e221-3c13-40c6-95db-d2db390e14b5'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [active, inactive]
                  default: active
      responses:
        '200':
          description: Policy status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      policy:
                        $ref: './schemas.yaml#/components/schemas/Policy'
                  error:
                    type: object
                    properties:
                      msg:
                        type: string

  '/api/paymaster/policy/{id}/stats':
    get:
      summary: Get Policy Stats
      description: Returns stats about a policy specified by ID, including signatures mined, signatures expired, signatures pending, USD mined, and USD pending.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            default: 'a844e221-3c13-40c6-95db-d2db390e14b5'
      responses:
        '200':
          description: Policy stats fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      signatures_mined:
                        type: integer
                        default: 10
                      signatures_expired:
                        type: integer
                        default: 1
                      signatures_pending:
                        type: integer
                        default: 1
                      usd_pending:
                        type: string
                        default: '25.03'
                      usd_mined:
                        type: string
                        default: '260.32'
                  error:
                    type: object
                    properties:
                      msg:
                        type: string
